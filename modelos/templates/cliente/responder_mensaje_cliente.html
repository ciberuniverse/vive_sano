{% extends 'base.html' %}

{% block contenido %}
<div class="container mt-4">
  <h5 class="fw-bold mb-3">Responder mensaje</h5>

  <div class="card shadow-sm mb-4">
    <div class="card-body">

      {% if codigo %}
        <div class="alert alert-warning text-center mb-0">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          Nada por aquí. No se encontró un mensaje para responder.
        </div>
      {% else %}
        <form method="POST" action="/mis-pedidos/{{ pedido_id }}/mensajes/responder/" class="row g-3">
          {% csrf_token %}

          <!-- Campo de texto -->
          <div class="col-12">
            <label for="mensaje" class="form-label">Tu respuesta</label>
            <textarea name="mensaje" id="mensaje" class="form-control" rows="4"
                      placeholder="Escribe tu mensaje aquí..."></textarea>
          </div>

          <!-- Botón de envío -->
          <div class="col-12 text-end">
            <button class="btn btn-success">
              <span class="material-symbols-outlined align-middle">send</span>
              <span class="align-middle">Enviar respuesta</span>
            </button>
          </div>
        </form>
      {% endif %}

    </div>
  </div>

  <!-- Historial de mensajes -->
  <h5 class="fw-bold mb-3">Historial de mensajes</h5>
  {% if mensajes %}
    <ul class="list-group">
      {% for mensaje in mensajes %}
        <li class="list-group-item">
          <div class="d-flex justify-content-between">
            <strong>{{ mensaje.get_tipo_display }}</strong>
            <small class="text-muted">{{ mensaje.fecha_envio|date:"d/m/Y H:i" }}</small>
          </div>
          <p class="mb-1">{{ mensaje.mensaje }}</p>
          {% if mensaje.respuesta_texto %}
            <div class="mt-2">
              <span class="badge 
                {% if mensaje.estado_respuesta == 'ACEPTADO' %}bg-success
                {% elif mensaje.estado_respuesta == 'RECHAZADO' %}bg-danger
                {% else %}bg-secondary{% endif %}">
                {{ mensaje.get_estado_respuesta_display }}
              </span>
              <p class="mb-0"><small>Respuesta: {{ mensaje.respuesta_texto }}</small></p>
              <small class="text-muted">Fecha respuesta: {{ mensaje.fecha_respuesta|date:"d/m/Y H:i" }}</small>
            </div>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <div class="alert alert-info text-center">
      No hay mensajes registrados para este pedido.
    </div>
  {% endif %}
</div>
{% endblock %}
